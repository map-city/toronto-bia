<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>Toronto Downtown West</title>
</head>

<body>
    <div id="map-container">
        <div id="map"></div>
    </div>

    <script>

        const minZoom = 12;
        const maxZoom = 18;

        var map = new maplibregl.Map({
            container: 'map',
            style: 'darkmode-mapbox.json',
            center: [-79.389641, 43.648183],
            zoom: 17,
            minZoom: minZoom,
            maxZoom: maxZoom,
            bearing: 0,
            pitch: 30,
            pixelRatio: 1,
            hash: true
        });

        map.on('load', () => {

            // map.addSource('toronto_buildings', {
            //     type: 'vector',
            //     tiles: ['https://mapcity.io/toronto-bia/data/toronto_buildings/{z}/{x}/{y}.pbf']
            // });

            // Add building outlines
            // map.addLayer({
            //     'id': 'buildings-outline',
            //     'source': 'toronto_buildings',
            //     'source-layer': 'toronto_buildings',
            //     'type': 'fill',
            //     'paint': {
            //         'fill-color': 'hsl(280, 10%, 40%)',
            //         'fill-opacity': ["interpolate", ["linear"], ["zoom"], 15, 0, 16, 0.1]
            //     },
            //     'minzoom': 15
            // });

            // // Add 3d buildings
            // map.addLayer({
            //     'id': 'buildings',
            //     'source': 'toronto_buildings',
            //     'source-layer': 'toronto_buildings',
            //     'type': 'fill-extrusion',
            //     'paint': {
            //         'fill-extrusion-color': 'hsl(252, 18%, 27%)',
            //         'fill-extrusion-height': [
            //             'case',
            //             ['!=', ['get', 'max_height'], null], ['get', 'max_height'],
            //             ['!=', ['get', 'avg_height'], null], ['get', 'avg_height'],
            //             10
            //         ],
            //         'fill-extrusion-base': 0,
            //         'fill-extrusion-opacity': ['interpolate', ['linear'], ['zoom'], 15, 0, 16, 0.5, 17, 0.5, 18, 0]
            //     },
            //     'minzoom': 15
            // });

            // Add neighborhood centroids
            // map.addSource('toronto_neighborhoods_centroids', {
            //     'type': 'geojson',
            //     'data': 'https://torontotechweek.github.io/data/toronto_neighborhoods_centroids.geojson'
            // });

            // // Add neighborhood labels
            // map.addLayer({
            //     id: 'neighborhoods-labels',
            //     type: 'symbol',
            //     source: 'toronto_neighborhoods_centroids',
            //     layout: {
            //         'text-field': ['get', 'area_name'],
            //         'text-size': ['interpolate', ['exponential', 1.1], ['zoom'], 10, 1, 18, 50],
            //         'text-font': ['montserrat-regular'],
            //         'text-max-width': 5,
            //         'text-line-height': 1,
            //         'text-allow-overlap': true,
            //         'text-ignore-placement': true,
            //         //'text-variable-anchor': ['top', 'bottom', 'left', 'right'],
            //         'text-rotation-alignment': 'viewport',
            //         'text-pitch-alignment': 'viewport'
            //     },
            //     paint: {
            //         'text-color': 'hsl(227, 89%, 90%)',
            //         'text-opacity': ['interpolate', ['linear'], ['zoom'], 12, 0, 13, 1, 18, 1]
            //     },
            //     "minzoom": 12,
            //     "maxzoom": 18
            // });

            // map.addSource('toronto_blocks', {
            //     type: 'geojson',
            //     data: 'data/toronto_block_centroids.geojson'
            // });

            // map.addSource('toronto_building_centroids', {
            //     type: 'geojson',
            //     data: 'data/toronto_building_centroids.geojson'
            // });

            // building points
            fetch('data/toronto_building_centroids.geojson')
                .then(response => response.json())
                .then(geojsonData => {
                    // Process the GeoJSON data directly
                    geojsonData.features.forEach(feature => {
                        if (feature.geometry && feature.geometry.coordinates && feature.properties.name) {
                            const coordinates = feature.geometry.coordinates;
                            const name = feature.properties.name;

                            // Create popup
                            const popup = new maplibregl.Popup({
                                closeOnClick: false,
                                closeButton: false,
                                anchor: 'bottom',
                                offset: [0, 0]
                            })
                                .setLngLat(coordinates)
                                .setHTML(`<h3>${name}</h3>`)
                                .addTo(map);

                            // Add the custom class to the popup element
                            const popupElement = popup.getElement();
                            popupElement.classList.add('popup-buildings');
                        }
                    });
                })
                .catch(error => console.error('Error loading GeoJSON:', error));

            // block points
            fetch('data/toronto_block_centroids.geojson')
                .then(response => response.json())
                .then(geojsonData => {
                    // Process the GeoJSON data directly
                    geojsonData.features.forEach(feature => {
                        if (feature.geometry && feature.geometry.coordinates && feature.properties.points && Array.isArray(feature.properties.points) && feature.properties.points.length > 0) {
                            const coordinates = feature.geometry.coordinates;
                            const pointsData = feature.properties.points;

                            let htmlContent = `<h1>DIRECTORY</h1>`;

                            pointsData.forEach((point, index) => {
                                const nameValue = point['name'] || point.name;
                                if (nameValue) {
                                    htmlContent += `<p>${nameValue}</p>`;
                                }
                            });

                            // Create popup
                            const popup = new maplibregl.Popup({
                                closeOnClick: false,
                                closeButton: false,
                                anchor: 'bottom',
                                offset: [0, 0]
                            })
                                .setLngLat(coordinates)
                                .setHTML(htmlContent)
                                .addTo(map);

                            // Add the custom class to the popup element
                            const popupElement = popup.getElement();
                            popupElement.classList.add('popup-blocks');
                        }
                    });
                })
                .catch(error => console.error('Error loading GeoJSON:', error));

        });
    </script>

</body>

</html>