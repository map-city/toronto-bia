<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<meta charset="UTF-8" />
	<script src="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.js"></script>
	<link href="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	<link rel="stylesheet" href="style.css">
	<title>Toronto Downtown West</title>

	<style>
		#actionOverlay {
			position: absolute;
			top: 0;
			left: 0;
			z-index: 999;
			background: rgba(255, 255, 255, 0.5);
			cursor: pointer;
			border-radius: 50%;
			width: 100px;
			height: 100px;
			margin: 20px;
		}
	</style>
</head>

<body>
	<div id="map-container">
		<div id="map"></div>
		<!--<div id="actionOverlay"></div>-->
		<!--<div id="map-toggle"><i class="fas fa-up-right-and-down-left-from-center"></i></div>-->
	</div>

	<script>

		const minZoom = 15;
		const maxZoom = 18;

		var map = new maplibregl.Map({
			container: 'map',
			style: 'toronto.json',
			center: [-79.3915, 43.64428],
			pixelRatio: 1,
			zoom: 16,
			minZoom: minZoom,
			maxZoom: maxZoom,
			bearing: -16,
			pitch: 0,
			hash: true
		});

		map.on('load', async () => {

			// Add neighborhood source
			map.addSource('toronto_neighborhoods', {
				type: 'vector',
				tiles: ['https://mapcity.io/toronto-bia/data/toronto_neighborhoods/{z}/{x}/{y}.pbf']
			});

			// Add neighborhood centroids
			map.addSource('toronto_neighborhoods_centroids', {
				'type': 'geojson',
				'data': 'https://mapcity.io/toronto-bia/data/toronto_neighborhoods_centroids.geojson'
			});

			// Add buildings source
			map.addSource('toronto_buildings', {
				type: 'vector',
				tiles: ['https://mapcity.io/toronto-bia/data/toronto_buildings/{z}/{x}/{y}.pbf']
			});

				// Add building outlines
				map.addLayer({
					'id': 'buildings-outline',
					'source': 'toronto_buildings',
					'source-layer': 'toronto_buildings',
					'type': 'line',
					'paint': {
						'line-color': 'hsl(0, 0%, 100%)',
						'line-width': 1.5,
						'line-opacity': ["interpolate", ["linear"], ["zoom"], 16, 0, 18, 1]
					},
					'minzoom': 18
				});

				// Add 3d buildings
				map.addLayer({
					'id': 'buildings',
					'source': 'toronto_buildings',
					'source-layer': 'toronto_buildings',
					'type': 'fill-extrusion',
					'paint': {
						'fill-extrusion-color': 'hsl(0, 0%, 100%)',
						'fill-extrusion-height': [
							'case',
							['!=', ['get', 'max_height'], null], ['get', 'max_height'],
							['!=', ['get', 'avg_height'], null], ['get', 'avg_height'],
							10
						],
						'fill-extrusion-base': 0,
						'fill-extrusion-opacity': ['interpolate', ['linear'], ['zoom'], 15, 0, 16, 0.4, 17, 0.4, 18, 0]
					},
					'minzoom': 15
				});

			});

	</script>

</body>

</html>